http=require("http");
Lock=require("./lock.js");

var MAX_REQUEST_POOL=2000;
var glock=new Lock(MAX_REQUEST_POOL);

exports.MakeGet=
function(hostname, port, pathAndQuery, callback, onError)
{
    glock.Lock(function()
    {
        var options = {
            hostname: hostname,
            port: port,
            path: pathAndQuery,
            method: 'GET',
            headers: {
                "remote-addr": "127.0.0.1"
            },
        };
        var req = http.request(options, function(res) {
            res.setEncoding('utf8');
            var body="";
            res.on('data', function (chunk) {
                body+=chunk;
            });
            res.on('end', function() {
                glock.Unlock();
                if (callback!=null)
                    callback(body);
            })
        });
        req.on('error', function(e) {
            glock.Unlock();
            if (onError!=null)
                onError(e);
        });

        req.end();
    });
}

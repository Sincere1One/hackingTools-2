net=require('./netInfrastructure');

exports.BAIDU_PORT1=40310;
exports.BAIDU_PORT2=6259;

function GetGeolocation(hostname, port, args, callback, onError)
{
    net.MakeGet(hostname, port, "/geolocation?mcmdf=inapp_", callback, onError);
}

exports.Func={
    "geo": GetGeolocation
};

exports.Go=
function(methodName, hostname, port, args, callback)
{
    var totalCount=1;
    var result={};
    function onFinishGenor(id)
    {
        return function(data)
        {
            result[id]=[1, data];
            totalCount--;
            if (totalCount==0)
                callback(result);
        };
    }
    function onErrorGenor(id)
    {
        return function(err)
        {
            result[id]=[0, err];
            totalCount--;
            if (totalCount==0)
                callback(result);
        };
    }

    while (true)
    {
        var thisIp=hostname.next();
        if (thisIp==null)
            break;
        totalCount++;
        this.Func[methodName](thisIp, port, args, onFinishGenor(thisIp), onErrorGenor(thisIp));
    }
    totalCount--;
    if (totalCount==0)
        callback(result);
}
